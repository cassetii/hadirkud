<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi Sosialisasi KUD 2026</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <style>
        :root {
            --navy-blue: #0A2647;
            --lime-green: #9DCC3C;
            --light-bg: #f8f9fa;
        }
        
        body {
            background: linear-gradient(135deg, var(--navy-blue) 0%, #144272 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px 15px;
        }
        
        .header-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .header-card h1 {
            color: var(--navy-blue);
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .event-info {
            background: linear-gradient(135deg, var(--lime-green), #B8E056);
            color: var(--navy-blue);
            padding: 15px;
            border-radius: 15px;
            margin-top: 15px;
        }
        
        .event-info i {
            margin-right: 8px;
        }
        
        .event-info p {
            margin: 8px 0;
            font-weight: 600;
        }
        
        .form-card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .form-card h5 {
            color: var(--navy-blue);
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .form-label {
            color: var(--navy-blue);
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .form-control {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 12px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--lime-green);
            box-shadow: 0 0 0 0.2rem rgba(157, 204, 60, 0.25);
        }
        
        .btn-submit {
            background: linear-gradient(135deg, var(--lime-green), #B8E056);
            color: var(--navy-blue);
            border: none;
            border-radius: 10px;
            padding: 12px 30px;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(157, 204, 60, 0.3);
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(157, 204, 60, 0.4);
            background: linear-gradient(135deg, #B8E056, var(--lime-green));
        }
        
        .attendance-list {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .attendance-list h5 {
            color: var(--navy-blue);
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .attendance-item {
            background: var(--light-bg);
            border-left: 4px solid var(--lime-green);
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 10px;
            transition: all 0.3s;
        }
        
        .attendance-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .attendance-item .name {
            color: var(--navy-blue);
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .attendance-item .unit {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .attendance-item .time {
            color: var(--lime-green);
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 5px;
        }
        
        .badge-count {
            background: var(--navy-blue);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 15px;
        }
        
        .alert {
            border-radius: 10px;
            border: none;
        }
        
        .spinner-border-sm {
            width: 1rem;
            height: 1rem;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .modal-content {
            border-radius: 20px;
            border: none;
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--lime-green), #B8E056);
            color: var(--navy-blue);
            border-radius: 20px 20px 0 0;
            border: none;
            padding: 20px 25px;
        }
        
        .modal-body {
            padding: 30px 25px;
            text-align: center;
        }
        
        .modal-body .success-icon {
            font-size: 4rem;
            color: var(--lime-green);
            margin-bottom: 20px;
        }
        
        .modal-body h5 {
            color: var(--navy-blue);
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .modal-body p {
            color: #666;
            line-height: 1.6;
        }
        
        .modal-footer {
            border: none;
            padding: 15px 25px 25px;
        }
        
        .btn-close-modal {
            background: var(--navy-blue);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 30px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-close-modal:hover {
            background: #144272;
            transform: translateY(-2px);
        }
        
        .document-links {
            border-top: 2px dashed #e0e0e0;
            padding-top: 20px;
        }
        
        .btn-document {
            background: white;
            color: var(--navy-blue);
            border: 2px solid var(--lime-green);
            border-radius: 10px;
            padding: 12px 20px;
            font-weight: 600;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-document:hover {
            background: linear-gradient(135deg, var(--lime-green), #B8E056);
            color: var(--navy-blue);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(157, 204, 60, 0.3);
            text-decoration: none;
        }
        
        .btn-document i {
            font-size: 1.2rem;
        }
        
        .btn-export {
            background: var(--navy-blue);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        .btn-export:hover {
            background: #144272;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(10, 38, 71, 0.3);
        }
        
        .btn-export i {
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="header-card">
            <h1>Sosialisasi Kebijakan Umum Direksi (KUD) Tahun 2026 serta penyusunan Program Kerja Strategis dan RPPB Tahun 2026</h1>
            <div class="event-info">
                <p><i class="bi bi-geo-alt-fill"></i> Hotel Melia</p>
                <p><i class="bi bi-calendar-event-fill"></i> Senin, 06 Oktober 2025</p>
            </div>
        </div>
        
        <!-- Form Absensi -->
        <div class="form-card">
            <h5><i class="bi bi-pencil-square"></i> Form Absensi</h5>
            <div id="alertContainer"></div>
            
            <form id="absensiForm">
                <div class="mb-3">
                    <label for="nama" class="form-label">Nama Lengkap</label>
                    <input type="text" class="form-control" id="nama" required placeholder="Masukkan nama lengkap">
                </div>
                
                <div class="mb-3">
                    <label for="unit" class="form-label">Unit/Divisi</label>
                    <select class="form-control" id="unit" required>
                        <option value="">Pilih Unit/Divisi</option>
                        <option value="SKAI">SKAI</option>
                        <option value="SKK">SKK</option>
                        <option value="SKMR">SKMR</option>
                        <option value="DKK">DKK</option>
                        <option value="DRK">DRK</option>
                        <option value="DIB">DIB</option>
                        <option value="DJS">DJS</option>
                        <option value="UPPK">UPPK</option>
                        <option value="DTR">DTR</option>
                        <option value="DPLK">DPLK</option>
                        <option value="DSY">DSY</option>
                        <option value="DDL">DDL</option>
                        <option value="DTI">DTI</option>
                        <option value="DKA">DKA</option>
                        <option value="DUM">DUM</option>
                        <option value="SIMO">SIMO</option>
                        <option value="DHC">DHC</option>
                        <option value="DCS">DCS</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label for="jabatan" class="form-label">Jabatan</label>
                    <input type="text" class="form-control" id="jabatan" required placeholder="Masukkan jabatan">
                </div>
                
                <button type="submit" class="btn btn-submit" id="submitBtn">
                    <i class="bi bi-check-circle-fill"></i> Hadir
                </button>
            </form>
        </div>
        
        <!-- Daftar Kehadiran -->
        <div class="attendance-list">
            <h5><i class="bi bi-people-fill"></i> Daftar Kehadiran</h5>
            <button class="btn btn-export w-100" id="exportBtn" onclick="exportToPDF()">
                <i class="bi bi-file-earmark-pdf-fill"></i> Export to PDF
            </button>
            <div class="badge-count">
                <i class="bi bi-person-check-fill"></i> Total: <span id="totalCount">0</span> Peserta
            </div>
            <div id="attendanceList">
                <div class="empty-state">
                    <i class="bi bi-inbox"></i>
                    <p>Belum ada peserta yang hadir</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="successModalLabel">
                        <i class="bi bi-check-circle-fill"></i> Absensi Berhasil
                    </h5>
                </div>
                <div class="modal-body">
                    <div class="success-icon">
                        <i class="bi bi-patch-check-fill"></i>
                    </div>
                    <h5>Terima Kasih!</h5>
                    <p>Kehadiran Anda telah tercatat dengan baik. Selamat mengikuti acara Sosialisasi Kebijakan Umum Direksi (KUD) Tahun 2026.</p>
                    <p class="mb-3"><strong>Semoga acara berjalan lancar dan bermanfaat!</strong></p>
                    
                    <div class="document-links mt-4">
                        <p class="text-start mb-2"><strong><i class="bi bi-file-earmark-text"></i> Dokumen Acara:</strong></p>
                        <a href="https://drive.google.com/file/d/1G5plYcU8x0oIMqaD9YupVc28JYcvsO7X/view?usp=sharing" target="_blank" class="btn btn-document mb-2 w-100">
                            <i class="bi bi-file-pdf"></i> Dokumen KUD 2026
                        </a>
                        <a href="https://drive.google.com/file/d/1a_lt851tc506DuvnEfXIswO9YBeHMX-x/view?usp=sharing" target="_blank" class="btn btn-document w-100">
                            <i class="bi bi-file-pdf"></i> Dokumen Penyusunan Proker dan RPPB
                        </a>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-close-modal" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js';

        const firebaseConfig = {
            apiKey: "AIzaSyD2mhuWx5J86ZkSss8NCFEg_atGclDI9-Q",
            authDomain: "nala-aircon-invoice.firebaseapp.com",
            projectId: "nala-aircon-invoice",
            storageBucket: "nala-aircon-invoice.firebasestorage.app",
            messagingSenderId: "919658647144",
            appId: "1:919658647144:web:ab2dd4eef29ed4c0b075dd",
            measurementId: "G-W23NB5KSBB"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // Reference ke collection
        const absensiRef = collection(db, 'absensi-kud-2026');
        
        // Global variable untuk menyimpan data
        window.absensiData = [];

        // Form submit
        document.getElementById('absensiForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const nama = document.getElementById('nama').value;
            const unit = document.getElementById('unit').value;
            const jabatan = document.getElementById('jabatan').value;
            
            // Disable button
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Menyimpan...';
            
            try {
                await addDoc(absensiRef, {
                    nama: nama,
                    unit: unit,
                    jabatan: jabatan,
                    waktu: Timestamp.now(),
                    tanggal: new Date().toISOString()
                });
                
                // Reset form
                document.getElementById('absensiForm').reset();
                
                // Show success modal
                const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                successModal.show();
                
            } catch (error) {
                console.error("Error: ", error);
                showAlert('danger', 'Terjadi kesalahan. Silakan coba lagi.');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="bi bi-check-circle-fill"></i> Hadir';
            }
        });

        // Real-time listener
        const q = query(absensiRef, orderBy('waktu', 'desc'));
        onSnapshot(q, (snapshot) => {
            const attendanceList = document.getElementById('attendanceList');
            const totalCount = document.getElementById('totalCount');
            
            // Update global data
            window.absensiData = [];
            
            if (snapshot.empty) {
                attendanceList.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-inbox"></i>
                        <p>Belum ada peserta yang hadir</p>
                    </div>
                `;
                totalCount.textContent = '0';
                document.getElementById('exportBtn').disabled = true;
            } else {
                let html = '';
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const waktu = data.waktu.toDate();
                    const timeString = waktu.toLocaleTimeString('id-ID', { 
                        hour: '2-digit', 
                        minute: '2-digit'
                    });
                    
                    // Simpan ke global data
                    window.absensiData.push({
                        nama: data.nama,
                        unit: data.unit,
                        jabatan: data.jabatan,
                        waktu: waktu
                    });
                    
                    html += `
                        <div class="attendance-item">
                            <div class="name">${data.nama}</div>
                            <div class="unit"><i class="bi bi-building"></i> ${data.unit}</div>
                            <div class="unit"><i class="bi bi-briefcase"></i> ${data.jabatan}</div>
                            <div class="time"><i class="bi bi-clock"></i> ${timeString}</div>
                        </div>
                    `;
                });
                
                attendanceList.innerHTML = html;
                totalCount.textContent = snapshot.size;
                document.getElementById('exportBtn').disabled = false;
            }
        });

        // Alert function
        function showAlert(type, message) {
            const alertContainer = document.getElementById('alertContainer');
            const alertHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    <i class="bi bi-${type === 'success' ? 'check-circle-fill' : 'exclamation-triangle-fill'}"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            alertContainer.innerHTML = alertHTML;
            
            setTimeout(() => {
                alertContainer.innerHTML = '';
            }, 3000);
        }
    </script>
    
    <!-- Export to PDF Function -->
    <script>
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(16);
            doc.setFont(undefined, 'bold');
            doc.text('DAFTAR HADIR', 105, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'normal');
            doc.text('Sosialisasi Kebijakan Umum Direksi (KUD) Tahun 2026', 105, 28, { align: 'center' });
            doc.text('serta penyusunan Program Kerja Strategis dan RPPB Tahun 2026', 105, 35, { align: 'center' });
            
            doc.setFontSize(10);
            doc.text('Hotel Melia, Senin 06 Oktober 2025', 105, 42, { align: 'center' });
            
            // Line separator
            doc.setDrawColor(157, 204, 60);
            doc.setLineWidth(0.5);
            doc.line(20, 48, 190, 48);
            
            // Prepare table data
            const tableData = window.absensiData.map((item, index) => {
                const waktu = item.waktu.toLocaleString('id-ID', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                return [
                    index + 1,
                    item.nama,
                    item.unit,
                    item.jabatan,
                    waktu
                ];
            });
            
            // Add table
            doc.autoTable({
                startY: 52,
                head: [['No', 'Nama Lengkap', 'Unit/Divisi', 'Jabatan', 'Waktu Hadir']],
                body: tableData,
                theme: 'striped',
                headStyles: {
                    fillColor: [10, 38, 71],
                    textColor: [255, 255, 255],
                    fontStyle: 'bold',
                    halign: 'center'
                },
                bodyStyles: {
                    textColor: [0, 0, 0]
                },
                columnStyles: {
                    0: { halign: 'center', cellWidth: 15 },
                    1: { cellWidth: 50 },
                    2: { halign: 'center', cellWidth: 25 },
                    3: { cellWidth: 45 },
                    4: { halign: 'center', cellWidth: 45 }
                },
                alternateRowStyles: {
                    fillColor: [245, 245, 245]
                },
                margin: { left: 20, right: 20 }
            });
            
            // Footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(128);
                doc.text(
                    `Total Peserta: ${window.absensiData.length} orang`,
                    20,
                    doc.internal.pageSize.height - 10
                );
                doc.text(
                    `Halaman ${i} dari ${pageCount}`,
                    doc.internal.pageSize.width - 20,
                    doc.internal.pageSize.height - 10,
                    { align: 'right' }
                );
            }
            
            // Generate filename with date
            const today = new Date();
            const filename = `Daftar_Hadir_KUD_2026_${today.getDate()}-${today.getMonth()+1}-${today.getFullYear()}.pdf`;
            
            // Save PDF
            doc.save(filename);
        }
    </script>
</body>
</html>
